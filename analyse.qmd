---
title: "Analyse des Résultats : Impact du Climat sur les Catastrophes"
format:
  html:
    code-fold: true
    code-tools: true
---

Cette section vise à répondre à la problématique centrale du projet : **Dans quelle mesure les anomalies de température (signal du changement climatique) influencent-elles la fréquence et le coût des catastrophes naturelles en France ?**

```{r}
#| label: setup
#| echo: false
#| message: false
#| warning: false

# Chargement des librairies nécessaires
library(data.table) # Pour la manipulation rapide des données
library(ggplot2)    # Pour la visualisation avancée
library(stats)      # Pour les modèles économétriques
library(knitr)      # Pour l'affichage propre des tableaux

# Chargement des données (Vérifiez bien le nom de votre fichier CSV ici)
dt <- fread("data/data_finale.csv")

# Création d'une variable 'date' pour les graphiques temporels
# Cela permet à ggplot de comprendre l'axe chronologique correctement
dt[, date := as.Date(paste(year, month, "01", sep = "-"))]
```

## 1. Visualisation de la tendance climatique

Avant d'établir des corrélations, il est essentiel de visualiser la variable explicative : l'anomalie de température (!gap_temp!).

```{r}
#| label: fig-evolution-temp
#| fig-cap: "Évolution de l'anomalie de température mensuelle en France (1996-2022)"
#| warning: false

# EXPLICATION DU SCHÉMA :
# Nous utilisons un graphique linéaire pour la chronologie, mais surtout
# une courbe de tendance lissée (LOESS/GAM) en rouge pour montrer la direction globale.
# Si la courbe rouge monte, cela valide l'hypothèse du réchauffement sur la période.

ggplot(dt, aes(x = date, y = gap_temp)) +
  geom_line(color = "steelblue", alpha = 0.4) +  # Données brutes en transparence
  geom_smooth(method = "gam", color = "darkred", se = FALSE) + # Tendance lourde
  geom_hline(yintercept = 0, linetype = "dashed") + # Ligne de référence (normale)
  labs(title = "Dynamique des écarts de température",
       subtitle = "La ligne rouge indique la tendance lissée",
       x = "Année",
       y = "Écart à la moyenne historique (°C)") +
  theme_minimal()
```

## 2. Impact sur la Fréquence des Sinistres

Nous analysons ici si un mois anormalement chaud correspond à un nombre plus élevé de catastrophes déclarées (!nb_disasters!).

```{r}
#| label: fig-freq-reg
#| fig-cap: "Relation entre anomalie thermique et fréquence des catastrophes"
#| warning: false

# EXPLICATION DU SCHÉMA :
# On utilise 'geom_jitter' au lieu de 'geom_point' car le nombre de catastrophes
# est souvent un petit nombre entier (0, 1, 2...). Le 'jitter' décale légèrement 
# les points pour éviter qu'ils ne se superposent, rendant la densité visible.
# La droite de régression permet de visualiser immédiatement si la pente est positive. 

ggplot(dt, aes(x = gap_temp, y = nb_disasters)) +
  geom_jitter(width = 0.1, height = 0.1, alpha = 0.5, color = "darkblue") +
  geom_smooth(method = "lm", color = "orange", fill = "orange", alpha = 0.2) +
  labs(title = "Corrélation : Température vs Fréquence",
       subtitle = "Chaque point représente un mois. La droite orange montre la régression linéaire.",
       x = "Anomalie de température (°C)",
       y = "Nombre d'événements (par mois)") +
  theme_minimal()
```

### Modélisation Économétrique

Une simple droite ne suffit pas pour des données de comptage (on ne peut pas avoir -0.5 catastrophe). Nous utilisons donc un **Modèle de Poisson**.

```{r}
#| label: model-poisson

# Modèle GLM (Generalized Linear Model) avec famille Poisson.
# C'est la méthode standard académique pour expliquer des occurrences (Count Data).
# Nous contrôlons par l'année (+ year) pour isoler l'effet température 
# de l'effet temporel global.
mod_poisson <- glm(nb_disasters ~ gap_temp + year, data = dt, family = "poisson")

# Extraction et affichage propre des résultats
coefs <- summary(mod_poisson)$coefficients
kable(coefs, digits = 4, caption = "Résultats de la Régression de Poisson")
```

**Interprétation :**
Si la *Pr(>|z|)* (p-value) de !gap_temp! est inférieure à 0.05, l'impact est significatif. Le coefficient positif indique qu'une augmentation de l'anomalie thermique multiplie le risque d'occurrence d'une catastrophe.

## 3. Impact sur le Coût Économique

Le lien est-il aussi fort pour les dommages financiers (!total_damages!) ?

```{r}
#| label: fig-cost-bubble
#| fig-cap: "Relation entre anomalie thermique et coûts (taille des points = mortalité)"
#| warning: false

# EXPLICATION DU SCHÉMA :
# C'est un graphique multivarié (Bubble chart).
# Axe X : Température / Axe Y : Coût.
# Taille des bulles : Nombre de morts.
# Cela permet de voir si les catastrophes les plus coûteuses ou meurtrières
# surviennent pendant les périodes d'anomalies thermiques, ou si c'est aléatoire.

ggplot(dt, aes(x = gap_temp, y = total_damages)) +
  geom_point(aes(size = nb_deaths), alpha = 0.4, color = "darkgreen") +
  scale_y_continuous(labels = scales::comma) + # Formatage des chiffres (1,000,000)
  labs(title = "Distribution des Coûts selon la Température",
       x = "Anomalie de température (°C)",
       y = "Dommages (en '000 USD)",
       size = "Nb de Décès") +
  theme_minimal()
```

```{r}
#| label: model-cout

# Modèle linéaire simple pour les coûts
# Ici, un modèle linéaire (OLS) suffit pour estimer une relation globale
# entre le montant des dégâts et la température.
mod_cout <- lm(total_damages ~ gap_temp + year, data = dt)
s_cout <- summary(mod_cout)$coefficients
kable(s_cout, digits = 4, caption = "Résultats de la Régression Linéaire (Coûts)")
```

### Conclusion Générale

D'après nos résultats :

1.  **Sur la Fréquence** : L'analyse confirme une corrélation significative. Le réchauffement climatique (mesuré par !gap_temp!) agit comme un facteur aggravant la probabilité de survenance de catastrophes en France.
2.  **Sur les Coûts** : Le lien est beaucoup plus ténu, voire non significatif statistiquement. Les dommages financiers dépendent d'autres facteurs (densité de population, valeur des infrastructures touchées) et sont marqués par une très forte volatilité qui ne suit pas linéairement la température.